<div class="container-xl py-4" style="max-width: 1200px">
  <div class="alert alert-danger" role="alert" *ngIf="error">
    <h4 class="alert-heading">Error</h4>
    <p>{{ error }}</p>
    <button class="btn btn-outline-danger" (click)="retryLoadData()">
      <i class="fas fa-redo"></i> Retry
    </button>
  </div>

  <div class="w-100" *ngIf="!error && isHost">
    <div class="row mb-4"></div>

    <!-- Host -->
    <div
      class="d-flex flex-column flex-lg-row gap-4 align-items-start mb-5"
      style="max-width: 1000px; margin: 0 auto"
      *ngIf="canShowProfile"
    >
      <div
        class="bg-white rounded-4 p-4 shadow-sm border flex-shrink-0"
        style="min-width: 400px"
      >
        <div class="d-flex flex-column flex-md-row align-items-center gap-4">
          <div class="flex-shrink-0 text-center">
            <div class="position-relative d-inline-block mb-3">
              <img
                [src]="
                  userProfile.profilePictureURL || '/assets/default-avatar.png'
                "
                [alt]="
                  (userProfile.firstName || '') +
                  ' ' +
                  (userProfile.lastName || '')
                "
                class="profile-avatar-img"
              />
              <div
                class="heart-badge"
                *ngIf="hostStats && hostStats.averageRating >= 4.8"
              >
                <i class="fas fa-heart"></i>
              </div>
            </div>
            <h2 class="fs-1 fw-semibold mb-1 text-dark">
              {{ userProfile.firstName || "Host" }}
            </h2>
            <p class="text-muted fs-5 fw-medium mb-0">
              {{ userProfile.country || "Location not specified" }}
            </p>
          </div>

          <div
            class="flex-fill border-start ps-4"
            *ngIf="canShowStats && hostStats"
          >
            <div class="d-flex flex-column gap-3">
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Reviews</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  hostStats.totalReviews
                }}</span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Rating</span>
                <span
                  class="fs-5 fw-semibold text-dark d-flex align-items-center gap-1"
                >
                  {{ hostStats.averageRating | number : "1.1-1" }}
                  <i class="fas fa-star text-danger"></i>
                </span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Months hosting</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  hostStats.monthsHosting
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-fill ps-lg-3">
        <h3 class="fs-4 fw-semibold text-dark mb-4">
          About {{ userProfile.firstName || "Host" }}
        </h3>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="userProfile.bio"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-briefcase text-muted"></i>
          </div>
          <div class="text-dark">My work: {{ userProfile.bio }}</div>
        </div>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="getBirthDecade()"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-birthday-cake text-muted"></i>
          </div>
          <div class="text-dark">{{ getBirthDecade() }}</div>
        </div>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="userProfile.country"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-map-marker-alt text-muted"></i>
          </div>
          <div class="text-dark">Lives in {{ userProfile.country }}</div>
        </div>

        <div class="d-flex align-items-start mb-3 gap-3">
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-shield-alt text-muted"></i>
          </div>
          <div class="text-success fw-medium">Identity verified</div>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>

    <div class="mb-5" *ngIf="canShowReviews && hasHostReviews">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fs-3 fw-bold text-darker mb-0">
          {{ userProfile.firstName || "Host" }}'s reviews
        </h3>
        <button
          class="btn btn-link text-decoration-none p-0 fw-semibold text-darker"
          (click)="openHostReviewsModal()"
        >
          Show all {{ hostReviews.length }} reviews
          <i class="fas fa-chevron-right ms-1"></i>
        </button>
      </div>

      <div class="reviews-scroll-container">
        <div class="d-flex gap-3 pb-2" style="scroll-behavior: smooth">
          <div
            class="flex-shrink-0"
            *ngFor="let review of hostReviews.slice(0, 10)"
          >
            <div class="review-card card border shadow-sm h-100">
              <div class="card-body p-4">
                <div class="d-flex align-items-center mb-3">
                  <img
                    [src]="
                      review.user?.profilePictureURL ||
                      '/assets/default-avatar.png'
                    "
                    [alt]="
                      (review.user?.firstName || '') +
                      ' ' +
                      (review.user?.lastName || '')
                    "
                    class="avatar-img me-3"
                  />
                  <div>
                    <h6 class="mb-0 fw-semibold text-darker">
                      {{ review.user.firstName }}
                    </h6>
                    <small class="text-muted">{{
                      review.user.country || formatDate(review.createdAt)
                    }}</small>
                  </div>
                </div>

                <div class="mb-3">
                  <div class="d-flex align-items-center gap-1 mb-1">
                    <span class="star-rating">
                      <i
                        *ngFor="let star of getStarArray(review.rating)"
                        class="fas fa-star"
                      ></i>
                      <i
                        *ngFor="let star of getStarArray(5 - review.rating)"
                        class="far fa-star"
                      ></i>
                    </span>
                  </div>
                  <small class="text-muted">{{
                    formatDate(review.createdAt)
                  }}</small>
                </div>

                <p
                  class="card-text text-darker mb-0"
                  style="font-size: 0.95rem; line-height: 1.5"
                >
                  {{ truncateText(review.comment || "", 120) }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="section-divider"
      *ngIf="canShowReviews && hasHostReviews && hasHostProperties"
    ></div>

    <div class="mb-5" *ngIf="canShowReviews && hasHostProperties">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fs-3 fw-bold text-darker mb-0">
          {{ userProfile.firstName || "Host" }}'s listings
        </h3>
        <button
          class="btn btn-link text-decoration-none p-0 fw-semibold text-darker"
          (click)="openHostPropertiesModal()"
        >
          Show all {{ uniqueHostProperties.length }} listings
          <i class="fas fa-chevron-right ms-1"></i>
        </button>
      </div>

      <div class="reviews-scroll-container">
        <div class="d-flex gap-3 pb-2" style="scroll-behavior: smooth">
          <div
            class="flex-shrink-0"
            *ngFor="let property of uniqueHostProperties.slice(0, 8)"
          >
            <div
              class="listing-card card border shadow-sm h-100 cursor-pointer"
              (click)="navigateToProperty(property.id)"
            >
              <img
                [src]="property.imageUrl || '/assets/default-property.jpg'"
                [alt]="property.title"
                class="property-img card-img-top"
              />
              <div class="card-body p-3">
                <h6
                  class="card-title text-darker fw-semibold mb-2"
                  style="font-size: 0.95rem"
                >
                  {{ property.title }}
                </h6>
                <div class="d-flex align-items-center">
                  <span class="star-rating me-1">
                    <i class="fas fa-star"></i>
                  </span>
                  <span
                    class="fw-semibold text-darker me-2"
                    style="font-size: 0.9rem"
                  >
                    {{
                      getAverageRatingForProperty(property.id)
                        | number : "1.1-1"
                    }}
                  </span>
                  <small class="text-muted">
                    ({{ getReviewCountForProperty(property.id) }})
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center py-5" *ngIf="canShowReviews && !hasHostReviews">
      <i class="fas fa-star fa-3x text-muted mb-3"></i>
      <h5 class="text-muted">No reviews yet</h5>
      <p class="text-muted">Reviews from your guests will appear here.</p>
    </div>
  </div>

  <div class="w-100" *ngIf="!error && !isHost">
    <div class="row mb-4"></div>

    <!-- Guest-->
    <div
      class="d-flex flex-column flex-lg-row gap-4 align-items-start mb-5"
      style="max-width: 1000px; margin: 0 auto"
      *ngIf="canShowProfile"
    >
      <div
        class="bg-white rounded-4 p-4 shadow-sm border flex-shrink-0"
        style="min-width: 400px"
      >
        <div class="d-flex flex-column flex-md-row align-items-center gap-4">
          <div class="flex-shrink-0 text-center">
            <div class="position-relative d-inline-block mb-3">
              <img
                [src]="
                  userProfile.profilePictureURL || '/assets/default-avatar.png'
                "
                [alt]="
                  (userProfile.firstName || '') +
                  ' ' +
                  (userProfile.lastName || '')
                "
                class="profile-avatar-img"
              />
              <div class="heart-badge">
                <i class="fas fa-heart"></i>
              </div>
            </div>
            <h2 class="fs-1 fw-semibold mb-1 text-dark">
              {{ userProfile.firstName || "Guest" }}
            </h2>
            <p class="text-muted fs-5 fw-medium mb-0">
              {{ userProfile.country || "Location not specified" }}
            </p>
          </div>

          <div
            class="flex-fill border-start ps-4"
            *ngIf="canShowStats && guestStats"
          >
            <div class="d-flex flex-column gap-3">
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Trips</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  guestStats.totalTrips
                }}</span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Reviews</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  guestStats.totalReviews
                }}</span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Years on Airbnb</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  guestStats.yearsOnPlatform
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-fill ps-lg-3">
        <h3 class="fs-4 fw-semibold text-dark mb-4">
          About {{ userProfile.firstName || "Guest" }}
        </h3>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="userProfile.bio"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-briefcase text-muted"></i>
          </div>
          <div class="text-dark">{{ userProfile.bio }}</div>
        </div>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="getBirthDecade()"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-birthday-cake text-muted"></i>
          </div>
          <div class="text-dark">{{ getBirthDecade() }}</div>
        </div>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="userProfile.country"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-map-marker-alt text-muted"></i>
          </div>
          <div class="text-dark">Lives in {{ userProfile.country }}</div>
        </div>

        <div class="d-flex align-items-start mb-3 gap-3">
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-shield-alt text-muted"></i>
          </div>
          <div class="text-success fw-medium">Identity verified</div>
        </div>
      </div>
    </div>

    <div
      class="bg-white rounded-4 p-4 shadow-sm border mb-5"
      *ngIf="canShowReviews && hasGuestReviews"
    >
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>My Reviews ({{ guestReviews.length }})</h4>
        <button
          class="btn btn-outline-primary btn-sm"
          (click)="openGuestReviewsModal()"
        >
          View all reviews
        </button>
      </div>

      <div class="position-relative overflow-hidden my-3">
        <div
          class="d-flex gap-3 overflow-auto pb-2"
          style="scroll-behavior: smooth"
        >
          <div
            class="flex-shrink-0"
            style="width: 320px"
            *ngFor="let review of guestReviews.slice(0, 10)"
          >
            <div
              class="card h-100 border rounded-3"
              style="
                min-height: 280px;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
              "
              onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0, 0, 0, 0.12)'"
              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''"
            >
              <div class="card-body p-4 d-flex flex-column h-100">
                <div class="mb-2">
                  <h6 class="card-title">Property #{{ review.propertyId }}</h6>
                  <small class="text-muted">{{
                    formatDate(review.createdAt)
                  }}</small>
                </div>

                <div class="mb-2">
                  <span class="star-rating">
                    <i
                      *ngFor="let star of getStarArray(review.rating)"
                      class="fas fa-star me-1"
                    ></i>
                    <i
                      *ngFor="let star of getStarArray(5 - review.rating)"
                      class="far fa-star me-1"
                    ></i>
                  </span>
                  <span class="ms-2">{{ review.rating }}</span>
                </div>

                <p class="card-text text-muted small flex-grow-1 mb-3 lh-base">
                  {{ truncateText(review.comment, 100) }}
                </p>

                <!-- Detailed Ratings -->
                <div class="mt-3 pt-3 border-top border-light">
                  <small class="d-block text-muted fw-medium lh-lg"
                    >Cleanliness: {{ review.cleanliness }}/5</small
                  >
                  <small class="d-block text-muted fw-medium lh-lg"
                    >Communication: {{ review.communication }}/5</small
                  >
                  <small class="d-block text-muted fw-medium lh-lg"
                    >Location: {{ review.location }}/5</small
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="bg-white rounded-4 p-4 shadow-sm border mb-5"
      *ngIf="canShowReviews && hasVisitedProperties"
    >
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Places I've Visited ({{ uniqueVisitedProperties.length }})</h4>
      </div>

      <div class="position-relative overflow-hidden my-3">
        <div
          class="d-flex gap-3 overflow-auto pb-2"
          style="scroll-behavior: smooth"
        >
          <div
            class="flex-shrink-0"
            style="width: 200px"
            *ngFor="let place of uniqueVisitedProperties"
          >
            <div
              class="card h-100 border rounded-3 cursor-pointer"
              style="
                min-height: 160px;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
              "
              onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0, 0, 0, 0.12)'"
              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''"
              (click)="navigateToProperty(place.id)"
            >
              <div
                class="card-body d-flex flex-column justify-content-center align-items-center text-center h-100 p-4"
              >
                <div class="visited-icon mb-3 mx-auto">
                  <i class="fas fa-map-marker-alt"></i>
                </div>
                <h6 class="card-title">Property #{{ place.id }}</h6>
                <p class="card-text text-muted small">Click to view details</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="bg-white rounded-4 p-4 shadow-sm border mb-5"
      *ngIf="canShowReviews && !hasGuestReviews"
    >
      <div class="text-center py-5">
        <i class="fas fa-suitcase fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">No reviews yet</h5>
        <p class="text-muted">
          Your reviews will appear here after your stays.
        </p>
      </div>
    </div>
  </div>

  <div
    class="modal fade"
    [class.show]="showHostReviewsModal"
    [style.display]="showHostReviewsModal ? 'block' : 'none'"
    tabindex="-1"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            All Host Reviews ({{ hostReviews.length }})
          </h5>
          <button
            type="button"
            class="btn-close"
            (click)="closeHostReviewsModal()"
          ></button>
        </div>
        <div class="modal-body">
          <div
            class="d-grid gap-4 p-2"
            style="
              grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
              max-height: 80vh;
              overflow-y: auto;
            "
          >
            <div *ngFor="let review of hostReviews" class="card">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <img
                    [src]="
                      review.user.profilePictureURL ||
                      '/assets/default-avatar.png'
                    "
                    [alt]="review.user.firstName + ' ' + review.user.lastName"
                    class="avatar-img me-3 border border-light border-2"
                  />
                  <div>
                    <h6 class="mb-0">
                      {{ review.user.firstName }} {{ review.user.lastName }}
                    </h6>
                    <small class="text-muted">{{
                      formatDate(review.createdAt)
                    }}</small>
                  </div>
                </div>

                <div class="mb-2" *ngIf="review.property">
                  <h6 class="card-title">{{ review.property.title }}</h6>
                  <small class="text-muted">{{
                    review.property.country
                  }}</small>
                </div>

                <div class="mb-2">
                  <span class="star-rating">
                    <i
                      *ngFor="let star of getStarArray(review.rating)"
                      class="fas fa-star me-1"
                    ></i>
                    <i
                      *ngFor="let star of getStarArray(5 - review.rating)"
                      class="far fa-star me-1"
                    ></i>
                  </span>
                  <span class="ms-2">{{ review.rating }}</span>
                </div>

                <p class="card-text">{{ review.comment }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    class="modal fade"
    [class.show]="showHostPropertiesModal"
    [style.display]="showHostPropertiesModal ? 'block' : 'none'"
    tabindex="-1"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            All Properties ({{ uniqueHostProperties.length }})
          </h5>
          <button
            type="button"
            class="btn-close"
            (click)="closeHostPropertiesModal()"
          ></button>
        </div>
        <div class="modal-body">
          <div
            class="d-grid gap-4 p-2"
            style="
              grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
              max-height: 80vh;
              overflow-y: auto;
            "
          >
            <div
              *ngFor="let property of uniqueHostProperties"
              class="card cursor-pointer"
              (click)="navigateToProperty(property.id)"
            >
              <img
                [src]="property.imageUrl || '/assets/default-property.jpg'"
                [alt]="property.title"
                class="property-img card-img-top rounded-top"
              />
              <div class="card-body">
                <h6 class="card-title">{{ property.title }}</h6>
                <p class="card-text text-muted">{{ property.location }}</p>
                <div class="d-flex align-items-center mb-2">
                  <span class="star-rating me-1">
                    <i class="fas fa-star"></i>
                  </span>
                  <span class="me-2">{{
                    getAverageRatingForProperty(property.id) | number : "1.1-1"
                  }}</span>
                  <small class="text-muted"
                    >({{
                      getReviewCountForProperty(property.id)
                    }}
                    reviews)</small
                  >
                </div>
                <button
                  class="btn btn-sm btn-outline-primary"
                  (click)="$event.stopPropagation()"
                >
                  View Reviews
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    class="modal fade"
    [class.show]="showGuestReviewsModal"
    [style.display]="showGuestReviewsModal ? 'block' : 'none'"
    tabindex="-1"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            All My Reviews ({{ guestReviews.length }})
          </h5>
          <button
            type="button"
            class="btn-close"
            (click)="closeGuestReviewsModal()"
          ></button>
        </div>
        <div class="modal-body">
          <div
            class="d-grid gap-4 p-2"
            style="
              grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
              max-height: 80vh;
              overflow-y: auto;
            "
          >
            <div *ngFor="let review of guestReviews" class="card">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-start mb-3"
                >
                  <div>
                    <h6 class="card-title">
                      Property #{{ review.propertyId }}
                    </h6>
                    <small class="text-muted">{{
                      formatDate(review.createdAt)
                    }}</small>
                  </div>
                  <div class="text-end">
                    <span class="star-rating">
                      <i
                        *ngFor="let star of getStarArray(review.rating)"
                        class="fas fa-star me-1"
                      ></i>
                      <i
                        *ngFor="let star of getStarArray(5 - review.rating)"
                        class="far fa-star me-1"
                      ></i>
                    </span>
                    <div class="small">{{ review.rating }}/5</div>
                  </div>
                </div>

                <p class="card-text mb-3">{{ review.comment }}</p>

                <div class="row text-center">
                  <div class="col-4">
                    <small class="text-muted d-block">Cleanliness</small>
                    <strong>{{ review.cleanliness }}/5</strong>
                  </div>
                  <div class="col-4">
                    <small class="text-muted d-block">Communication</small>
                    <strong>{{ review.communication }}/5</strong>
                  </div>
                  <div class="col-4">
                    <small class="text-muted d-block">Value</small>
                    <strong>{{ review.value }}/5</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div
    *ngIf="
      showHostReviewsModal || showHostPropertiesModal || showGuestReviewsModal
    "
    class="modal-backdrop fade show"
    (click)="
      closeHostReviewsModal();
      closeHostPropertiesModal();
      closeGuestReviewsModal()
    "
  ></div>
</div>
