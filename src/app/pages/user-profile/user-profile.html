<div class="container-xl py-4" style="max-width: 1200px">
  <div class="alert alert-danger" role="alert" *ngIf="error">
    <h4 class="alert-heading">Error</h4>
    <p>{{ error }}</p>
    <button class="btn btn-outline-danger" (click)="retryLoadData()">
      <i class="fas fa-redo"></i> Retry
    </button>
  </div>

  <div class="w-100" *ngIf="!error && isHost">
    <div class="row mb-4"></div>

    <!-- Host -->
    <div
      class="d-flex flex-column flex-lg-row gap-4 align-items-start mb-5"
      style="max-width: 1000px; margin: 0"
      *ngIf="canShowProfile"
    >
      <div
        class="bg-white rounded-4 p-4 shadow-sm border flex-shrink-0"
        style="min-width: 380px"
      >
        <div class="d-flex flex-column flex-md-row align-items-center gap-4">
          <div class="flex-shrink-0 text-center">
            <div class="position-relative d-inline-block mb-3">
              <img
                *ngIf="
                  shouldShowImage(
                    userProfile.user?.profilePictureURL,
                    userProfile.id
                  )
                "
                [src]="getImageUrl(userProfile.user?.profilePictureURL)"
                [alt]="
                  (userProfile.user?.firstName || '') +
                  ' ' +
                  (userProfile.user?.lastName || '')
                "
                class="rounded-circle"
                style="width: 80px; height: 80px; object-fit: cover"
                (error)="onImageError($event, userProfile)"
              />
              <div
                *ngIf="
                  shouldShowFallback(
                    userProfile.user?.profilePictureURL,
                    userProfile.id
                  )
                "
                class="bg-primary rounded-circle d-flex align-items-center justify-content-center text-white fw-bold"
                style="width: 80px; height: 80px"
              >
                {{
                  getInitials(
                    userProfile.user?.firstName || "",
                    userProfile.user?.lastName || ""
                  )
                }}
              </div>
              <div
                class="position-absolute top-0 start-100 translate-middle bg-danger rounded-circle d-flex align-items-center justify-content-center text-white"
                style="width: 20px; height: 20px; font-size: 0.7rem"
                *ngIf="hostStats && hostStats.averageRating >= 4.8"
              >
                <i class="fas fa-heart"></i>
              </div>
            </div>
            <h2 class="fs-1 fw-semibold mb-1 text-dark">
              {{ userProfile.firstName || "Host" }}
            </h2>
            <p class="text-muted fs-5 fw-medium mb-0">
              {{ userProfile.country || "Location not specified" }}
            </p>
          </div>

          <div
            class="flex-fill border-start ps-4"
            *ngIf="canShowStats && hostStats"
          >
            <div class="d-flex flex-column gap-3">
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Reviews</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  hostStats.totalReviews
                }}</span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Rating</span>
                <span
                  class="fs-5 fw-semibold text-dark d-flex align-items-center gap-1"
                >
                  {{ hostStats.averageRating | number : "1.1-1" }}
                  <i class="fas fa-star text-warning"></i>
                </span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Months hosting</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  hostStats.monthsHosting
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-fill ps-lg-3">
        <h3 class="fs-4 fw-semibold text-dark mb-4">
          About {{ userProfile.firstName || "Host" }}
        </h3>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="userProfile.bio"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-briefcase text-muted"></i>
          </div>
          <div class="text-dark">My work: {{ userProfile.bio }}</div>
        </div>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="getBirthDecade()"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-birthday-cake text-muted"></i>
          </div>
          <div class="text-dark">{{ getBirthDecade() }}</div>
        </div>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="userProfile.country"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-map-marker-alt text-muted"></i>
          </div>
          <div class="text-dark">Lives in {{ userProfile.country }}</div>
        </div>

        <div class="d-flex align-items-start mb-3 gap-3">
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-shield-alt text-muted"></i>
          </div>
          <div class="text-success fw-medium">Identity verified</div>
        </div>
      </div>
    </div>

    <hr class="my-5" />

    <div class="mb-5" *ngIf="canShowReviews && hasHostReviews">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fs-3 fw-bold text-dark mb-0">
          {{ userProfile.firstName || "Host" }}'s reviews
        </h3>

        <div class="d-flex align-items-center gap-2">
          <button
            class="btn btn-outline-secondary rounded-circle p-2"
            style="width: 40px; height: 40px"
            (click)="scrollReviews('left')"
          >
            <i class="fas fa-chevron-left"></i>
          </button>
          <button
            class="btn btn-outline-secondary rounded-circle p-2"
            style="width: 40px; height: 40px"
            (click)="scrollReviews('right')"
          >
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>

      <div class="overflow-hidden">
        <div
          #reviewsContainer
          class="d-flex gap-3 pb-2 transition-transform"
          style="scroll-behavior: smooth; transform: translateX(0px)"
        >
          <div
            class="flex-shrink-0"
            *ngFor="let review of hostReviews.slice(0, 10)"
            style="width: 280px"
          >
            <div class="card border-0 h-100" style="min-height: 250px">
              <div class="card-body p-3">
                <div class="d-flex align-items-center mb-3">
                  <img
                    *ngIf="
                      review.user?.profilePictureURL &&
                      !imageErrors.has(review.user.userId)
                    "
                    [src]="getImageUrl(review.user.profilePictureURL)"
                    [alt]="
                      (review.user?.firstName || '') +
                      ' ' +
                      (review.user?.lastName || '')
                    "
                    class="rounded-circle me-3"
                    style="width: 40px; height: 40px; object-fit: cover"
                    (error)="onImageError($event, review.user)"
                  />
                  <div
                    *ngIf="
                      !review.user?.profilePictureURL ||
                      imageErrors.has(review.user?.userId)
                    "
                    class="bg-primary rounded-circle d-flex align-items-center justify-content-center text-white fw-bold me-3"
                    style="width: 40px; height: 40px; font-size: 0.8rem"
                  >
                    {{
                      getInitials(
                        review.user?.firstName || "",
                        review.user?.lastName || ""
                      )
                    }}
                  </div>
                  <div>
                    <h6 class="mb-0 fw-semibold text-dark">
                      {{ review.user.firstName }}
                    </h6>
                    <small class="text-muted">
                      {{ review.user.country || formatDate(review.createdAt) }}
                    </small>
                  </div>
                </div>

                <div class="mb-2">
                  <div class="d-flex align-items-center gap-1 mb-1">
                    <span class="text-warning">
                      <i
                        *ngFor="let star of getStarArray(review.rating)"
                        class="fas fa-star"
                      ></i>
                      <i
                        *ngFor="let star of getStarArray(5 - review.rating)"
                        class="far fa-star"
                      ></i>
                    </span>
                  </div>
                  <small class="text-muted">{{
                    formatDate(review.createdAt)
                  }}</small>
                </div>

                <p
                  class="text-dark mb-0"
                  style="font-size: 0.9rem; line-height: 1.5"
                >
                  {{ truncateText(review.comment || "", 120) }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button
        class="btn btn-md mt-3 px-4 py-3 fw-medium border shadow-sm rounded-3 show-more-reviews-btn"
        (click)="openHostReviewsModal()"
      >
        Show more reviews
      </button>
    </div>

    <hr
      class="my-5"
      *ngIf="canShowReviews && hasHostReviews && hasHostProperties"
    />

    <div class="mb-5" *ngIf="canShowReviews && hasHostProperties">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fs-3 fw-bold text-dark mb-0">
          {{ userProfile.firstName || "Host" }}'s listings
        </h3>
        <div class="d-flex align-items-center gap-3">
          <div class="d-flex align-items-center gap-2">
            <button
              class="btn btn-outline-secondary rounded-circle p-2"
              style="width: 40px; height: 40px"
              (click)="scrollListings('left')"
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            <button
              class="btn btn-outline-secondary rounded-circle p-2"
              style="width: 40px; height: 40px"
              (click)="scrollListings('right')"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="overflow-hidden">
        <div
          #listingsContainer
          class="d-flex gap-3 pb-2 transition-transform"
          style="scroll-behavior: smooth; transform: translateX(0px)"
        >
          <div
            class="flex-shrink-0"
            *ngFor="let property of uniqueHostProperties.slice(0, 8)"
          >
            <div
              class="card border shadow-sm h-100"
              style="width: 240px; cursor: pointer"
              (click)="navigateToProperty(property.id)"
            >
              <img
                *ngIf="shouldShowImage(property.imageUrl, property.id)"
                [src]="getImageUrl(property.imageUrl)"
                [alt]="property.title"
                class="card-img-top"
                style="height: 160px; object-fit: cover"
                (error)="onImageError($event, property)"
              />
              <div
                *ngIf="shouldShowFallback(property.imageUrl, property.id)"
                class="bg-light d-flex align-items-center justify-content-center card-img-top"
                style="height: 160px"
              >
                <i class="fas fa-home text-muted fa-2x"></i>
              </div>
              <div class="card-body p-3">
                <h6
                  class="card-title text-dark fw-semibold mb-2"
                  style="font-size: 0.9rem"
                >
                  {{ property.title }}
                </h6>
                <div class="d-flex align-items-center">
                  <span class="text-warning me-1">
                    <i class="fas fa-star"></i>
                  </span>
                  <span
                    class="fw-semibold text-dark me-2"
                    style="font-size: 0.85rem"
                  >
                    {{
                      getAverageRatingForProperty(property.id)
                        | number : "1.1-1"
                    }}
                  </span>
                  <small class="text-muted">
                    ({{ getReviewCountForProperty(property.id) }})
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button
        class="btn btn-link text-decoration-none p-0 fw-semibold text-dark"
        (click)="openHostPropertiesModal()"
      >
        Show all {{ uniqueHostProperties.length }} listings
        <i class="fas fa-chevron-right ms-1"></i>
      </button>
    </div>

    <div class="text-center py-5" *ngIf="canShowReviews && !hasHostReviews">
      <i class="fas fa-star fa-3x text-muted mb-3"></i>
      <h5 class="text-muted">No reviews yet</h5>
      <p class="text-muted">Reviews from your guests will appear here.</p>
    </div>
  </div>

  <div class="w-100" *ngIf="!error && !isHost">
    <div class="row mb-4"></div>

    <!-- Guest-->
    <div
      class="d-flex flex-column flex-lg-row gap-4 align-items-start mb-5"
      style="max-width: 1000px; margin: 0"
      *ngIf="canShowProfile"
    >
      <div
        class="bg-white rounded-4 p-4 shadow-sm border flex-shrink-0"
        style="min-width: 380px"
      >
        <div class="d-flex flex-column flex-md-row align-items-center gap-4">
          <div class="flex-shrink-0 text-center">
            <div class="position-relative d-inline-block mb-3">
              <img
                *ngIf="
                  shouldShowImage(userProfile.profilePictureURL, userProfile.id)
                "
                [src]="getImageUrl(userProfile.profilePictureURL)"
                [alt]="
                  (userProfile.firstName || '') +
                  ' ' +
                  (userProfile.lastName || '')
                "
                class="rounded-circle"
                style="width: 80px; height: 80px; object-fit: cover"
                (error)="onImageError($event, userProfile)"
              />
              <div
                *ngIf="
                  shouldShowFallback(
                    userProfile.profilePictureURL,
                    userProfile.id
                  )
                "
                class="bg-primary rounded-circle d-flex align-items-center justify-content-center text-white fw-bold"
                style="width: 80px; height: 80px"
              >
                {{
                  getInitials(
                    userProfile.firstName || "",
                    userProfile.lastName || ""
                  )
                }}
              </div>
              <div
                class="position-absolute top-0 start-100 translate-middle bg-danger rounded-circle d-flex align-items-center justify-content-center text-white"
                style="width: 20px; height: 20px; font-size: 0.7rem"
              >
                <i class="fas fa-heart"></i>
              </div>
            </div>
            <h2 class="fs-1 fw-semibold mb-1 text-dark">
              {{ userProfile.firstName || "Guest" }}
            </h2>
            <p class="text-muted fs-5 fw-medium mb-0">
              {{ userProfile.country || "Location not specified" }}
            </p>
          </div>

          <div
            class="flex-fill border-start ps-4"
            *ngIf="canShowStats && guestStats"
          >
            <div class="d-flex flex-column gap-3">
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Trips</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  guestStats.totalTrips
                }}</span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Reviews</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  guestStats.totalReviews
                }}</span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center py-2"
              >
                <span class="fs-5 text-dark fw-medium">Years on Platform</span>
                <span class="fs-5 fw-semibold text-dark">{{
                  guestStats.yearsOnPlatform
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-fill ps-lg-3">
        <h3 class="fs-4 fw-semibold text-dark mb-4">
          About {{ userProfile.firstName || "Guest" }}
        </h3>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="userProfile.bio"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-briefcase text-muted"></i>
          </div>
          <div class="text-dark">{{ userProfile.bio }}</div>
        </div>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="getBirthDecade()"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-birthday-cake text-muted"></i>
          </div>
          <div class="text-dark">{{ getBirthDecade() }}</div>
        </div>

        <div
          class="d-flex align-items-start mb-3 gap-3"
          *ngIf="userProfile.country"
        >
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-map-marker-alt text-muted"></i>
          </div>
          <div class="text-dark">Lives in {{ userProfile.country }}</div>
        </div>

        <div class="d-flex align-items-start mb-3 gap-3">
          <div
            class="d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px; margin-top: 2px"
          >
            <i class="fas fa-shield-alt text-muted"></i>
          </div>
          <div class="text-success fw-medium">Identity verified</div>
        </div>
      </div>
    </div>

    <div
      class="bg-white rounded-4 p-4 shadow-sm border mb-5"
      *ngIf="canShowReviews && hasGuestReviews"
    >
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>My Reviews ({{ guestReviews.length }})</h4>
        <button
          class="btn btn-outline-primary btn-sm"
          (click)="openGuestReviewsModal()"
        >
          View all reviews
        </button>
      </div>

      <div class="overflow-auto my-3">
        <div class="d-flex gap-3 pb-2" style="scroll-behavior: smooth">
          <div
            class="flex-shrink-0"
            style="width: 300px"
            *ngFor="let review of guestReviews.slice(0, 10)"
          >
            <div class="card h-100 border rounded-3" style="min-height: 260px">
              <div class="card-body p-4 d-flex flex-column h-100">
                <div class="mb-2">
                  <h6 class="card-title">Property #{{ review.propertyId }}</h6>
                  <small class="text-muted">{{
                    formatDate(review.createdAt)
                  }}</small>
                </div>

                <div class="mb-2">
                  <span class="text-warning">
                    <i
                      *ngFor="let star of getStarArray(review.rating)"
                      class="fas fa-star me-1"
                    ></i>
                    <i
                      *ngFor="let star of getStarArray(5 - review.rating)"
                      class="far fa-star me-1"
                    ></i>
                  </span>
                  <span class="ms-2">{{ review.rating }}</span>
                </div>

                <p class="card-text text-muted small flex-grow-1 mb-3 lh-base">
                  {{ truncateText(review.comment, 100) }}
                </p>

                <!-- Detailed Ratings -->
                <div class="mt-3 pt-3 border-top border-light">
                  <small class="d-block text-muted fw-medium lh-lg"
                    >Cleanliness: {{ review.cleanliness }}/5</small
                  >
                  <small class="d-block text-muted fw-medium lh-lg"
                    >Communication: {{ review.communication }}/5</small
                  >
                  <small class="d-block text-muted fw-medium lh-lg"
                    >Location: {{ review.location }}/5</small
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="bg-white rounded-4 p-4 shadow-sm border mb-5"
      *ngIf="canShowReviews && hasVisitedProperties"
    >
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Places I've Visited ({{ uniqueVisitedProperties.length }})</h4>
      </div>

      <div class="overflow-auto my-3">
        <div class="d-flex gap-3 pb-2" style="scroll-behavior: smooth">
          <div
            class="flex-shrink-0"
            style="width: 180px"
            *ngFor="let place of uniqueVisitedProperties"
          >
            <div
              class="card h-100 border rounded-3"
              style="min-height: 140px; cursor: pointer"
              (click)="navigateToProperty(place.id)"
            >
              <div
                class="card-body d-flex flex-column justify-content-center align-items-center text-center h-100 p-3"
              >
                <div
                  class="text-primary mb-2 mx-auto"
                  style="font-size: 1.5rem"
                >
                  <i class="fas fa-map-marker-alt"></i>
                </div>
                <h6 class="card-title small">Property #{{ place.id }}</h6>
                <p class="card-text text-muted small">Click to view details</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="bg-white rounded-4 p-4 shadow-sm border mb-5"
      *ngIf="canShowReviews && !hasGuestReviews"
    >
      <div class="text-center py-5">
        <i class="fas fa-suitcase fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">No reviews yet</h5>
        <p class="text-muted">
          Your reviews will appear here after your stays.
        </p>
      </div>
    </div>
  </div>

  <!-- Host Reviews Modal -->
  <div
    class="modal fade airbnb-modal"
    [class.show]="showHostReviewsModal"
    [style.display]="showHostReviewsModal ? 'block' : 'none'"
    tabindex="-1"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content border-0">
        <!-- Header -->
        <div class="modal-header border-0 px-4 pt-4 pb-0">
          <h1 class="modal-title fs-4 fw-semibold text-dark">
            {{ hostReviews.length }} reviews
          </h1>
          <button
            type="button"
            class="btn-close-custom d-flex align-items-center justify-content-center border-0 bg-transparent"
            (click)="closeHostReviewsModal()"
          >
            <i class="fas fa-times fs-6 text-secondary"></i>
          </button>
        </div>

        <!-- Tab Navigation -->
        <div class="mx-4 mt-3 border-bottom">
          <div class="d-flex">
            <button
              class="tab-btn btn btn-link text-decoration-none p-0 pb-3 me-4 fw-medium text-dark border-0 active"
            >
              From guests • {{ hostReviews.length }}
            </button>
            <button
              class="tab-btn btn btn-link text-decoration-none p-0 pb-3 me-4 fw-medium text-secondary border-0"
            >
              From hosts • 0
            </button>
          </div>
        </div>

        <!-- Modal Body -->
        <div
          class="modal-body px-4 py-4"
          style="max-height: 60vh; overflow-y: auto"
        >
          <div
            *ngFor="let review of hostReviews; let last = last"
            [class]="last ? 'd-flex' : 'd-flex pb-4 mb-4 border-bottom'"
          >
            <!-- Avatar -->
            <img
              *ngIf="
                shouldShowImage(
                  review.user?.profilePictureURL,
                  review.user?.userId
                )
              "
              [src]="getImageUrl(review.user?.profilePictureURL)"
              [alt]="review.user.firstName + ' ' + review.user.lastName"
              class="rounded-circle me-3 flex-shrink-0"
              style="width: 56px; height: 56px; object-fit: cover"
              (error)="onImageError($event, review.user)"
            />

            <div
              *ngIf="
                shouldShowFallback(
                  review.user?.profilePictureURL,
                  review.user?.userId
                )
              "
              class="avatar-fallback rounded-circle d-flex align-items-center justify-content-center text-white fw-semibold me-3 flex-shrink-0"
              style="width: 56px; height: 56px; font-size: 20px"
            >
              {{
                getInitials(
                  review.user?.firstName || "",
                  review.user?.lastName || ""
                )
              }}
            </div>

            <!-- Review Content -->
            <div class="flex-grow-1">
              <h3 class="fs-6 fw-semibold text-dark mb-0">
                {{ review.user.firstName }} {{ review.user.lastName }}
              </h3>

              <div class="d-flex align-items-center my-2">
                <div class="stars me-2">
                  <i
                    *ngFor="let star of getStarArray(review.rating)"
                    class="fas fa-star"
                  ></i>
                  <i
                    *ngFor="let star of getStarArray(5 - review.rating)"
                    class="far fa-star"
                  ></i>
                </div>
                <span class="small text-secondary"
                  >• {{ formatDate(review.createdAt) }}</span
                >
              </div>

              <p class="fs-6 text-dark mb-2" style="line-height: 1.5">
                {{ review.comment }}
              </p>

              <div *ngIf="review.property" class="small text-secondary mt-2">
                {{ review.property.title }} • {{ review.property.country }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Host Properties Modal -->
  <div
    class="modal fade airbnb-modal"
    [class.show]="showHostPropertiesModal"
    [style.display]="showHostPropertiesModal ? 'block' : 'none'"
    tabindex="-1"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content border-0">
        <!-- Header -->
        <div class="modal-header border-0 px-4 pt-4 pb-0">
          <h1 class="modal-title fs-4 fw-semibold text-dark">
            {{ uniqueHostProperties.length }} listings
          </h1>
          <button
            type="button"
            class="btn-close-custom d-flex align-items-center justify-content-center border-0 bg-transparent"
            (click)="closeHostPropertiesModal()"
          >
            <i class="fas fa-times fs-6 text-secondary"></i>
          </button>
        </div>

        <!-- Modal Body -->
        <div
          class="modal-body px-4 py-4"
          style="max-height: 70vh; overflow-y: auto"
        >
          <div class="row g-4">
            <div
              *ngFor="let property of uniqueHostProperties"
              class="col-12 col-md-6 col-lg-4"
            >
              <div
                class="card h-100 border shadow-sm"
                style="cursor: pointer; transition: all 0.3s ease"
                (click)="navigateToProperty(property.id)"
              >
                <img
                  *ngIf="shouldShowImage(property.imageUrl, property.id)"
                  [src]="getImageUrl(property.imageUrl)"
                  [alt]="property.title"
                  class="card-img-top"
                  style="height: 200px; object-fit: cover"
                  (error)="onImageError($event, property)"
                />
                <div
                  *ngIf="shouldShowFallback(property.imageUrl, property.id)"
                  class="bg-light d-flex align-items-center justify-content-center card-img-top"
                  style="height: 200px"
                >
                  <i class="fas fa-home text-muted fa-3x"></i>
                </div>
                <div class="card-body p-3">
                  <h6 class="card-title fw-semibold mb-2">
                    {{ property.title }}
                  </h6>
                  <p class="card-text text-muted small mb-2">
                    {{ property.location }}
                  </p>
                  <div class="d-flex align-items-center">
                    <span class="text-warning me-1">
                      <i class="fas fa-star"></i>
                    </span>
                    <span class="fw-semibold me-2">{{
                      getAverageRatingForProperty(property.id)
                        | number : "1.1-1"
                    }}</span>
                    <small class="text-muted"
                      >({{
                        getReviewCountForProperty(property.id)
                      }}
                      reviews)</small
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Guest Reviews Modal -->
  <div
    class="modal fade airbnb-modal"
    [class.show]="showGuestReviewsModal"
    [style.display]="showGuestReviewsModal ? 'block' : 'none'"
    tabindex="-1"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content border-0">
        <!-- Header -->
        <div class="modal-header border-0 px-4 pt-4 pb-0">
          <h1 class="modal-title fs-4 fw-semibold text-dark">
            My Reviews ({{ guestReviews.length }})
          </h1>
          <button
            type="button"
            class="btn-close-custom d-flex align-items-center justify-content-center border-0 bg-transparent"
            (click)="closeGuestReviewsModal()"
          >
            <i class="fas fa-times fs-6 text-secondary"></i>
          </button>
        </div>

        <!-- Modal Body -->
        <div
          class="modal-body px-4 py-4"
          style="max-height: 70vh; overflow-y: auto"
        >
          <div class="row g-4">
            <div
              *ngFor="let review of guestReviews"
              class="col-12 col-md-6 col-lg-4"
            >
              <div class="card h-100" style="transition: all 0.2s ease">
                <div class="card-body p-4">
                  <div
                    class="d-flex justify-content-between align-items-start mb-3"
                  >
                    <div>
                      <h6 class="card-title fw-semibold">
                        Property #{{ review.propertyId }}
                      </h6>
                      <small class="text-muted">{{
                        formatDate(review.createdAt)
                      }}</small>
                    </div>
                    <div class="text-end">
                      <div class="stars mb-1">
                        <i
                          *ngFor="let star of getStarArray(review?.rating || 0)"
                          class="fas fa-star"
                        ></i>
                        <i
                          *ngFor="
                            let star of getStarArray(5 - (review?.rating || 0))
                          "
                          class="far fa-star"
                        ></i>
                      </div>
                      <small class="text-muted">{{ review?.rating }}/5</small>
                    </div>
                  </div>

                  <p class="card-text mb-3" style="line-height: 1.5">
                    {{ review?.comment }}
                  </p>

                  <div class="row text-center pt-3 border-top border-light">
                    <div class="col-4">
                      <small class="text-muted d-block">Cleanliness</small>
                      <strong class="text-dark"
                        >{{ review?.cleanliness }}/5</strong
                      >
                    </div>
                    <div class="col-4">
                      <small class="text-muted d-block">Communication</small>
                      <strong class="text-dark"
                        >{{ review?.communication }}/5</strong
                      >
                    </div>
                    <div class="col-4">
                      <small class="text-muted d-block">Value</small>
                      <strong class="text-dark">{{ review?.value }}/5</strong>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
