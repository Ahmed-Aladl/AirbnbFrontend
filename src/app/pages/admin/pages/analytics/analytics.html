<!-- Analytics Container -->
<div class="analytics-container">
  
  <!-- Loading Overlay -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner">
      <i class="fas fa-chart-line fa-spin"></i>
      <p>Loading analytics data...</p>
    </div>
  </div>

  <!-- Analytics Header -->
  <div class="analytics-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-chart-bar title-icon"></i>
        Analytics Dashboard
      </h1>
      <p class="page-subtitle">Comprehensive insights and performance metrics</p>
    </div>
    <div class="header-actions">
    
      <button class="btn btn-primary" (click)="refreshAnalytics()" [disabled]="loading">
        <i class="fas fa-sync-alt"></i>
        Refresh
      </button>
    </div>
  </div>

  <!-- Financial Analytics Section -->
  <!-- Financial Analytics Section -->
<div class="analytics-section">
  <div class="section-header">
    <h2 class="section-title">
      <i class="fas fa-dollar-sign"></i>
      Financial Analytics
    </h2>
  </div>
  
  <!-- Revenue Overview Card -->
  <div class="revenue-overview-card">
    <div class="revenue-main">
      <div class="revenue-primary">
        <div class="revenue-amount">{{ formatCurrency(analytics.totalRevenue) }}</div>
        <div class="revenue-label">Total Revenue</div>
        <div class="revenue-subtitle">From {{ getTotalCompletedBookings() }} bookings</div>
      </div>
    </div>
    
    <div class="revenue-breakdown">
      <!-- Website Profit -->
      <div class="profit-item website-profit">
        <div class="profit-amount">{{ formatCurrency(getWebsiteProfit()) }}</div>
        <div class="profit-label">Website Profit (10%)</div>
        <div class="profit-subtitle">Platform commission</div>
      </div>
      
      <!-- Host Profit -->
      <div class="profit-item host-profit">
        <div class="profit-amount">{{ formatCurrency(getHostProfit()) }}</div>
        <div class="profit-label">Host Profit (90%)</div>
        <div class="profit-subtitle">Host earnings</div>
      </div>
    </div>
  </div>
  
  <div class="financial-grid">
    <!-- Monthly Revenue Card -->
    <div class="financial-card monthly-revenue">
      <div class="card-header">
        <div class="card-icon">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="card-title">Monthly Revenue</div>
      </div>
      <div class="card-value">{{ formatCurrency(analytics.monthlyRevenue) }}</div>
      <div class="card-subtitle">
        <span class="growth-indicator" [class.positive]="analytics.revenueGrowth > 0" [class.negative]="analytics.revenueGrowth < 0">
          <i class="fas" [class.fa-arrow-up]="analytics.revenueGrowth > 0" [class.fa-arrow-down]="analytics.revenueGrowth < 0"></i>
          {{ formatPercentage(analytics.revenueGrowth) }}
        </span>
        vs last month
      </div>
    </div>

    <!-- Average Booking Value Card -->
    <div class="financial-card avg-booking">
      <div class="card-header">
        <div class="card-icon">
          <i class="fas fa-receipt"></i>
        </div>
        <div class="card-title">Avg Booking Value</div>
      </div>
      <div class="card-value">{{ formatCurrency(analytics.averageBookingValue) }}</div>
      <div class="card-subtitle">Per booking average</div>
    </div>

    <!-- Yearly Revenue Card -->
    <div class="financial-card yearly-revenue">
      <div class="card-header">
        <div class="card-icon">
          <i class="fas fa-chart-pie"></i>
        </div>
        <div class="card-title">Year to Date</div>
      </div>
      <div class="card-value">{{ formatCurrency(analytics.yearlyRevenue) }}</div>
      <div class="card-subtitle">{{ currentDate.getFullYear() }} earnings</div>
    </div>
  </div>
</div>

  <!-- Performance Analytics Section -->
  <div class="analytics-section">
    <div class="section-header">
      <h2 class="section-title">
        <i class="fas fa-tachometer-alt"></i>
        Performance Metrics
      </h2>
    </div>
    
    <div class="performance-grid">
      <!-- Occupancy Rate -->
      <div class="performance-card">
        <div class="performance-header">
          <span class="performance-label">Occupancy Rate</span>
          <span class="performance-value">{{ analytics.occupancyRate.toFixed(1) }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="analytics.occupancyRate"></div>
        </div>
      </div>

      <!-- Average Stay Duration -->
      <div class="performance-card">
        <div class="performance-header">
          <span class="performance-label">Avg Stay Duration</span>
          <span class="performance-value">{{ analytics.averageStayDuration.toFixed(1) }} days</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="(analytics.averageStayDuration / 14) * 100"></div>
        </div>
      </div>

      <!-- Booking Conversion Rate -->
      <div class="performance-card">
        <div class="performance-header">
          <span class="performance-label">Conversion Rate</span>
          <span class="performance-value">{{ analytics.bookingConversionRate.toFixed(1) }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="analytics.bookingConversionRate"></div>
        </div>
      </div>

      <!-- Customer Retention Rate -->
      <div class="performance-card">
        <div class="performance-header">
          <span class="performance-label">Retention Rate</span>
          <span class="performance-value">{{ analytics.customerRetentionRate.toFixed(1) }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="analytics.customerRetentionRate"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Growth Analytics Section -->
  <div class="analytics-section">
    <div class="section-header">
      <h2 class="section-title">
        <i class="fas fa-trending-up"></i>
        Growth Analytics
      </h2>
    </div>
    
    <div class="growth-grid">
      <!-- User Growth -->
      <div class="growth-card">
        <div class="growth-header">
          <div class="growth-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="growth-info">
            <div class="growth-title">User Growth</div>
            <div class="growth-period">Last 30 days</div>
          </div>
        </div>
        <div class="growth-value">
          <span class="growth-percentage" [class.positive]="analytics.userGrowthRate > 0">
            {{ formatPercentage(analytics.userGrowthRate) }}
          </span>
        </div>
        <div class="growth-chart">
          <div class="mini-chart">
            <div class="chart-line" [class.positive]="analytics.userGrowthRate > 0"></div>
          </div>
        </div>
      </div>

      <!-- Property Growth -->
      <div class="growth-card">
        <div class="growth-header">
          <div class="growth-icon">
            <i class="fas fa-building"></i>
          </div>
          <div class="growth-info">
            <div class="growth-title">Property Growth</div>
            <div class="growth-period">Last 30 days</div>
          </div>
        </div>
        <div class="growth-value">
          <span class="growth-percentage" [class.positive]="analytics.propertyGrowthRate > 0">
            {{ formatPercentage(analytics.propertyGrowthRate) }}
          </span>
        </div>
        <div class="growth-chart">
          <div class="mini-chart">
            <div class="chart-line" [class.positive]="analytics.propertyGrowthRate > 0"></div>
          </div>
        </div>
      </div>

      <!-- Booking Growth -->
      <div class="growth-card">
        <div class="growth-header">
          <div class="growth-icon">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="growth-info">
            <div class="growth-title">Booking Growth</div>
            <div class="growth-period">Last 30 days</div>
          </div>
        </div>
        <div class="growth-value">
          <span class="growth-percentage" [class.positive]="analytics.bookingGrowthRate > 0">
            {{ formatPercentage(analytics.bookingGrowthRate) }}
          </span>
        </div>
        <div class="growth-chart">
          <div class="mini-chart">
            <div class="chart-line" [class.positive]="analytics.bookingGrowthRate > 0"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="charts-grid">
      
      <!-- Monthly Revenue Chart -->
      <div class="chart-container">
        <div class="chart-header">
          <h3 class="chart-title">Monthly Revenue Trend</h3>
          <div class="chart-legend">
            <span class="legend-item">
              <span class="legend-color revenue-color"></span>
              Revenue
            </span>
          </div>
        </div>
        <div class="chart-content">
          <div class="line-chart">
            <div class="chart-grid">
              <div *ngFor="let data of monthlyRevenueData; let i = index" class="chart-bar-container">
                <div class="chart-bar" 
                     [style.height.%]="(data.revenue / getMaxRevenue()) * 100"
                     [title]="formatCurrency(data.revenue)">
                </div>
                <div class="chart-label">{{ data.month }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Booking Status Chart -->
      <div class="chart-container">
        <div class="chart-header">
          <h3 class="chart-title">Booking Status Distribution</h3>
        </div>
        <div class="chart-content">
          <div class="pie-chart">
            <div class="pie-legend">
              <div *ngFor="let item of bookingStatusData" class="legend-item">
                <span class="legend-color" [style.background-color]="item.color"></span>
                <span class="legend-label">{{ item.label }}</span>
                <span class="legend-value">{{ item.value }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Property Status Chart -->
      <div class="chart-container">
        <div class="chart-header">
          <h3 class="chart-title">Property Status Overview</h3>
        </div>
        <div class="chart-content">
          <div class="donut-chart">
            <div class="donut-legend">
              <div *ngFor="let item of propertyStatusData" class="legend-item">
                <span class="legend-color" [style.background-color]="item.color"></span>
                <span class="legend-label">{{ item.label }}</span>
                <span class="legend-value">{{ item.value }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- User Activity Chart -->
      <div class="chart-container">
        <div class="chart-header">
          <h3 class="chart-title">User Activity Status</h3>
        </div>
        <div class="chart-content">
          <div class="bar-chart">
            <div *ngFor="let item of userActivityData" class="bar-item">
              <div class="bar-label">{{ item.label }}</div>
              <div class="bar-container">
                <div class="bar-fill" 
                     [style.width.%]="(item.value / getTotalUsersCount()) * 100"
                     [style.background-color]="item.color">
                </div>
              </div>
              <div class="bar-value">{{ item.value }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Geographic Analytics Section -->
  <div class="analytics-section">
    <div class="section-header">
      <h2 class="section-title">
        <i class="fas fa-globe"></i>
        Geographic Analytics
      </h2>
    </div>
    
    <div class="geographic-grid">
      <!-- Top Cities -->
      <div class="geographic-container">
        <div class="geographic-header">
          <h3 class="geographic-title">Top Cities</h3>
        </div>
        <div class="geographic-list">
          <div *ngFor="let city of analytics.topCities; let i = index" class="geographic-item">
            <div class="geographic-rank">{{ i + 1 }}</div>
            <div class="geographic-info">
              <div class="geographic-name">{{ city.label }}</div>
              <div class="geographic-count">{{ city.value }} bookings</div>
            </div>
            <div class="geographic-bar">
              <div class="geographic-fill" 
                   [style.width.%]="getPercentageWidth(city.value, analytics.topCities)"
                   [style.background-color]="city.color">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Countries -->
      <div class="geographic-container">
        <div class="geographic-header">
          <h3 class="geographic-title">Top Countries</h3>
        </div>
        <div class="geographic-list">
          <div *ngFor="let country of analytics.topCountries; let i = index" class="geographic-item">
            <div class="geographic-rank">{{ i + 1 }}</div>
            <div class="geographic-info">
              <div class="geographic-name">{{ country.label }}</div>
              <div class="geographic-count">{{ country.value }} bookings</div>
            </div>
            <div class="geographic-bar">
              <div class="geographic-fill" 
                   [style.width.%]="getPercentageWidth(country.value, analytics.topCountries)"
                   [style.background-color]="country.color">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Advanced Analytics Section -->
  <div class="analytics-section">
    <div class="section-header">
      <h2 class="section-title">
        <i class="fas fa-brain"></i>
        Advanced Insights
      </h2>
    </div>
    
    <div class="insights-grid">
      <!-- Revenue per User -->
      <div class="insight-card">
        <div class="insight-header">
          <i class="fas fa-user-dollar"></i>
          <span class="insight-title">Revenue per User</span>
        </div>
        <div class="insight-value">
          {{ formatCurrency(getRevenuePerUser()) }}
        </div>
        <div class="insight-description">
          Average revenue generated per registered user
        </div>
      </div>

      <!-- Revenue per Property -->
      <div class="insight-card">
        <div class="insight-header">
          <i class="fas fa-home-dollar"></i>
          <span class="insight-title">Revenue per Property</span>
        </div>
        <div class="insight-value">
          {{ formatCurrency(getRevenuePerProperty()) }}
        </div>
        <div class="insight-description">
          Average revenue generated per property
        </div>
      </div>

      <!-- Booking Frequency -->
      <div class="insight-card">
        <div class="insight-header">
          <i class="fas fa-calendar-week"></i>
          <span class="insight-title">Booking Frequency</span>
        </div>
        <div class="insight-value">
          {{ getBookingFrequency() }}
        </div>
        <div class="insight-description">
          Average bookings per user
        </div>
      </div>

      <!-- Platform Efficiency -->
      <div class="insight-card">
        <div class="insight-header">
          <i class="fas fa-chart-area"></i>
          <span class="insight-title">Platform Efficiency</span>
        </div>
        <div class="insight-value">
          {{ getPlatformEfficiency() }}$
        </div>
        <div class="insight-description">
          Platform commission per user
        </div>
      </div>
    </div>
  </div>

  <!-- Real-time Metrics Section -->
  <div class="analytics-section">
    <div class="section-header">
      <h2 class="section-title">
        <i class="fas fa-broadcast-tower"></i>
        Real-time Metrics
      </h2>
    </div>
    
    <div class="realtime-grid">
      <!-- Active Users Today -->
      <div class="realtime-card">
        <div class="realtime-indicator active"></div>
        <div class="realtime-content">
          <div class="realtime-value">{{ getActiveUsersCount() }}</div>
          <div class="realtime-label">Active Users</div>
        </div>
      </div>

      <!-- Pending Bookings -->
      <div class="realtime-card">
        <div class="realtime-indicator pending"></div>
        <div class="realtime-content">
          <div class="realtime-value">{{ getPendingBookingsCount() }}</div>
          <div class="realtime-label">Pending Bookings</div>
        </div>
      </div>

      <!-- Available Properties -->
      <div class="realtime-card">
        <div class="realtime-indicator available"></div>
        <div class="realtime-content">
          <div class="realtime-value">{{ getAvailablePropertiesCount() }}</div>
          <div class="realtime-label">Available Properties</div>
        </div>
      </div>

      <!-- Today's Revenue -->
      <div class="realtime-card">
        <div class="realtime-indicator revenue"></div>
        <div class="realtime-content">
          <div class="realtime-value">{{ formatCurrency(getTodayRevenue()) }}</div>
          <div class="realtime-label">Today's Revenue</div>
        </div>
      </div>
    </div>
  </div>

</div>