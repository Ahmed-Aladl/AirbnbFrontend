<div class="airbnb-listing-editor">
  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p>Loading your listing...</p>
    </div>
  </div>

  <!-- Header -->
  <div class="editor-header">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <button class="back-btn" type="button">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8.354 1.646a.5.5 0 0 1 0 .708L3.207 7.5H14.5a.5.5 0 0 1 0 1H3.207l5.147 5.146a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
          </svg>
        </button>
        <h1 class="editor-title">Listing editor</h1>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="editor-content">
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-12 col-lg-4 col-xl-3">
          <div class="sidebar">
            <div class="sidebar-header">
              <h6>Your space</h6>
            </div>

            <!-- Scrollable Menu -->
            <div class="menu-container">
              <div class="menu-list">
                <div
                  *ngFor="let section of menuSections; trackBy:trackBySection"
                  class="menu-item-wrapper">
                  <button
                    class="menu-item"
                    [class.active]="section.isActive"
                    (click)="onMenuSectionClick(section)"
                    type="button">
                    
                    <div class="menu-item-content">
                      <div class="menu-item-icon">{{ section.icon }}</div>
                      <div class="menu-item-text">
                        <span class="menu-item-label">{{ section.label }}</span>
                        <div class="menu-item-status" *ngIf="section.lastSaved">
                          <span class="saved-indicator">Saved {{ section.lastSaved | date:'short' }}</span>
                        </div>
                      </div>
                    </div>

                    <div class="menu-item-actions">
                      <!-- Loading indicator -->
                      <span *ngIf="section.isSaving" class="saving-indicator">üíæ</span>
                      <!-- Changes indicator -->
                      <span *ngIf="section.hasChanges && !section.isSaving" class="changes-dot">‚óè</span>
                    </div>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-12 col-lg-8 col-xl-9">
          <div class="content-area">
            <div class="content-wrapper" *ngIf="property">
              <form [formGroup]="propertyForm">
                
                <!-- Photos Section -->
                <div *ngIf="activeSection === 'photos'" class="section-content">
                  <div class="section-header">
                    <h2>Add some photos of your house</h2>
                    <p>You'll need 5 photos to get started. You can add more or make changes later.</p>
                  </div>
                  
                  <!-- Upload Status -->
                  <div *ngIf="uploading" class="upload-status">
                    <div class="upload-progress">
                      <div class="progress-bar">
                        <div class="progress-fill" [style.width.%]="uploadProgress"></div>
                      </div>
                      <span class="progress-text">Uploading... {{uploadProgress}}%</span>
                    </div>
                  </div>
                  
                  <div class="photos-grid">
                    <!-- Existing Property Photos -->
                    <div class="photo-item" *ngFor="let photo of property?.photos; let i = index">
                      <div class="photo-wrapper">
                        <img [src]="baseUrl + '/' + photo.imageUrl" [alt]="'Property photo ' + (i + 1)" class="photo-image" 
                             onerror="this.src='assets/placeholder-image.jpg'">
                        <!-- <button type="button" class="photo-remove-btn" (click)="onExistingPhotoRemove(photo.id)">
                          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                          </svg>
                        </button> -->
                      </div>
                    </div>

                    <!-- Preview Selected Files (before upload) -->
                    <div class="photo-item" *ngFor="let file of selectedFiles; let i = index">
                      <div class="photo-wrapper preview-photo">
                        <img [src]="getPreviewUrl(file)" [alt]="'Preview ' + (i + 1)" class="photo-image">
                        <button type="button" class="photo-remove-btn" (click)="removeSelectedFile(i)">
                          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                          </svg>
                        </button>
                        <div class="preview-badge">Preview</div>
                      </div>
                    </div>
                    
                    <!-- Add Photo Button -->
                    <div class="photo-item">
                      <div class="add-photo-btn" (click)="photoInput.click()">
                        <div class="add-photo-content">
                          <svg width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                          </svg>
                          <span>Add photos</span>
                          <small *ngIf="selectedFiles.length > 0">({{selectedFiles.length}} selected)</small>
                        </div>
                      </div>
                      <input 
                        type="file" 
                        #photoInput 
                        (change)="onFilesSelected($event)" 
                        accept="image/*" 
                        multiple 
                        class="d-none">
                    </div>
                  </div>

                  <!-- Upload Selected Files Button -->
                  <div *ngIf="selectedFiles.length > 0" class="upload-section">
                    <button
                      type="button"
                      class="upload-selected-btn"
                      [disabled]="uploading"
                      (click)="uploadSelectedPhotosWithValidation()">
                      <span *ngIf="uploading" class="spinner">‚è≥</span>
                      <span *ngIf="!uploading">Upload {{selectedFiles.length}} Photo{{selectedFiles.length > 1 ? 's' : ''}}</span>
                    </button>
                    <button
                      type="button"
                      class="clear-selected-btn"
                      [disabled]="uploading"
                      (click)="clearSelectedFiles()">
                      Clear Selection
                    </button>
                  </div>

                  <!-- Photo Requirements -->
                  <div class="photo-requirements" *ngIf="getTotalPhotoCount() < 5">
                    <div class="requirement-item">
                      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                      </svg>
                      <span>You need {{5 - getTotalPhotoCount()}} more photo{{5 - getTotalPhotoCount() > 1 ? 's' : ''}} to continue</span>
                    </div>
                  </div>

                  <!-- Save Section for Photos -->
                  <div class="content-save-section">
                    <button
                      type="button"
                      class="save-btn-content"
                      [class]="getSaveButtonClass()"
                      [disabled]="!hasChangesInActiveSection() || isSavingActiveSection()"
                      (click)="onSaveCurrentSection()">
                      <span *ngIf="isSavingActiveSection()" class="spinner">‚è≥</span>
                      <span *ngIf="!isSavingActiveSection()">{{ getSaveButtonText() }}</span>
                    </button>
                  </div>
                </div>

                <!-- Title Section -->
                <div *ngIf="activeSection === 'title'" class="section-content">
                  <div class="section-header">
                    <h2>Now, let's give your house a title</h2>
                    <p>Short titles work best. Have fun with it‚Äîyou can always change it later.</p>
                  </div>
                  
                  <div class="form-group">
                    <textarea
                      formControlName="title"
                      class="form-control title-input"
                      [class.is-invalid]="isFieldInvalid('title')"
                      placeholder="Cozy and good"
                      maxlength="50"
                      rows="3"></textarea>
                    <div class="character-count">{{ (propertyForm.get('title')?.value || '').length }}/50</div>
                    <div class="invalid-feedback" *ngIf="isFieldInvalid('title')">
                      {{ getFieldError('title') }}
                    </div>
                  </div>

                  <!-- Save Section for Title -->
                  <div class="content-save-section">
                    <button
                      type="button"
                      class="save-btn-content"
                      [class]="getSaveButtonClass()"
                      [disabled]="!hasChangesInActiveSection() || isSavingActiveSection() || isFieldInvalid('title')"
                      (click)="onSaveCurrentSection()">
                      <span *ngIf="isSavingActiveSection()" class="spinner">‚è≥</span>
                      <span *ngIf="!isSavingActiveSection()">{{ getSaveButtonText() }}</span>
                    </button>
                  </div>
                </div>

                <!-- Property Type Section -->
                <div *ngIf="activeSection === 'propertyId'" class="section-content">
                  <div class="section-header">
                    <h2>Which of these best describes your place?</h2>
                  </div>
                  
                  <div class="property-types-grid">
                    <div class="property-type-item" *ngFor="let type of propertyTypes; let i = index">
                      <button
                        type="button"
                        class="property-type-btn"
                        [class.selected]="propertyForm.get('propertyId')?.value === (i + 1)"
                        (click)="propertyForm.patchValue({propertyId: i + 1})">
                        <span>{{ type }}</span>
                        <svg *ngIf="propertyForm.get('propertyId')?.value === (i + 1)" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                        </svg>
                      </button>
                    </div>
                  </div>

                  <!-- Save Section for Property Type -->
                  <div class="content-save-section">
                    <button
                      type="button"
                      class="save-btn-content"
                      [class]="getSaveButtonClass()"
                      [disabled]="!hasChangesInActiveSection() || isSavingActiveSection() || !propertyForm.get('propertyId')?.value"
                      (click)="onSaveCurrentSection()">
                      <span *ngIf="isSavingActiveSection()" class="spinner">‚è≥</span>
                      <span *ngIf="!isSavingActiveSection()">{{ getSaveButtonText() }}</span>
                    </button>
                  </div>
                </div>

                <!-- Price Section -->
                <div *ngIf="activeSection === 'price'" class="section-content">
                  <div class="section-header">
                    <h2>Now, set your price</h2>
                    <p>You can change it anytime.</p>
                  </div>
                  
                  <div class="price-input-wrapper">
                    <div class="price-input-container">
                      <span class="currency-symbol">$</span>
                      <input
                        type="number"
                        formControlName="price"
                        class="form-control price-input"
                        [class.is-invalid]="isFieldInvalid('price')"
                        placeholder="0"
                        min="1"
                        step="1">
                    </div>
                    <div class="price-suffix">per night</div>
                  </div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('price')">
                    {{ getFieldError('price') }}
                  </div>

                  <!-- Save Section for Price -->
                  <div class="content-save-section">
                    <button
                      type="button"
                      class="save-btn-content"
                      [class]="getSaveButtonClass()"
                      [disabled]="!hasChangesInActiveSection() || isSavingActiveSection() || isFieldInvalid('price')"
                      (click)="onSaveCurrentSection()">
                      <span *ngIf="isSavingActiveSection()" class="spinner">‚è≥</span>
                      <span *ngIf="!isSavingActiveSection()">{{ getSaveButtonText() }}</span>
                    </button>
                  </div>
                </div>

                <!-- Guests Section -->
                <div *ngIf="activeSection === 'maxGuests'" class="section-content">
                  <div class="section-header">
                    <h2>How many guests can your place accommodate?</h2>
                    <p>Choose the maximum number of guests who can comfortably stay.</p>
                  </div>
                  
                  <!-- Guest Icons Display -->
                  <div class="guest-icons-container">
                    <div class="guest-icons-grid">
                      <img 
                        *ngFor="let icon of getGuestIconsToShow(); trackBy: trackByGuestIcon; let i = index" 
                        [src]="icon" 
                        [alt]="'Guest ' + (i + 1)"
                        class="guest-icon"
                        onerror="this.style.display='none'"
                        >
                    </div>
                    
                    <!-- Counter Controls -->
                    <div class="counter-controls">
                      <button
                        type="button"
                        class="counter-btn"
                        [disabled]="(propertyForm.get('maxGuests')?.value || 1) <= 1"
                        (click)="propertyForm.patchValue({maxGuests: Math.max(1, (propertyForm.get('maxGuests')?.value || 1) - 1)})">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                        </svg>
                      </button>
                      
                      <span class="counter-value">{{ propertyForm.get('maxGuests')?.value || 1 }} guest{{(propertyForm.get('maxGuests')?.value || 1) > 1 ? 's' : ''}}</span>
                      
                      <button
                        type="button"
                        class="counter-btn"
                        [disabled]="(propertyForm.get('maxGuests')?.value || 1) >= 16"
                        (click)="propertyForm.patchValue({maxGuests: Math.min(16, (propertyForm.get('maxGuests')?.value || 1) + 1)})">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg> 
                      </button>
                    </div>
                  </div>

                  <!-- Save Section for Guests -->
                  <div class="content-save-section">
                    <button
                      type="button"
                      class="save-btn-content"
                      [class]="getSaveButtonClass()"
                      [disabled]="!hasChangesInActiveSection() || isSavingActiveSection()"
                      (click)="onSaveCurrentSection()">
                      <span *ngIf="isSavingActiveSection()" class="spinner">‚è≥</span>
                      <span *ngIf="!isSavingActiveSection()">{{ getSaveButtonText() }}</span>
                    </button>
                  </div>
                </div>

                <!-- Description Section -->
                <div *ngIf="activeSection === 'description'" class="section-content">
                  <div class="section-header">
                    <h2>Create your description</h2>
                    <p>Share what makes your place special.</p>
                  </div>
                  
                  <div class="form-group">
                    <textarea
                      formControlName="description"
                      class="form-control description-input"
                      [class.is-invalid]="isFieldInvalid('description')"
                      placeholder="You'll have a great time at this comfortable place to stay."
                      maxlength="500"
                      rows="5"></textarea>
                    <div class="character-count">{{ (propertyForm.get('description')?.value || '').length }}/500</div>
                    <div class="invalid-feedback" *ngIf="isFieldInvalid('description')">
                      {{ getFieldError('description') }}
                    </div>
                  </div>

                  <!-- Save Section for Description -->
                  <div class="content-save-section">
                    <button
                      type="button"
                      class="save-btn-content"
                      [class]="getSaveButtonClass()"
                      [disabled]="!hasChangesInActiveSection() || isSavingActiveSection() || isFieldInvalid('description')"
                      (click)="onSaveCurrentSection()">
                      <span *ngIf="isSavingActiveSection()" class="spinner">‚è≥</span>
                      <span *ngIf="!isSavingActiveSection()">{{ getSaveButtonText() }}</span>
                    </button>
                  </div>
                </div>

                <!-- Amenities Section -->
                <div *ngIf="activeSection === 'amenities'" class="section-content">
                  <div class="section-header">
                    <h2>Tell guests what your place has to offer</h2>
                    <p>You can add more amenities after you publish your listing.</p>
                  </div>
                  
                  <div class="amenities-grid">
                    <div class="amenity-item" *ngFor="let amenity of availableAmenities">
                      <button
                        type="button"
                        class="amenity-btn"
                        [class.selected]="isAmenitySelected(amenity)"
                        (click)="onAmenityToggle(amenity)">
                        <span>{{ amenity }}</span>
                        <svg *ngIf="isAmenitySelected(amenity)" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                        </svg>
                      </button>
                    </div>
                  </div>

                  <!-- Save Section for Amenities -->
                  <div class="content-save-section">
                    <button
                      type="button"
                      class="save-btn-content"
                      [class]="getSaveButtonClass()"
                      [disabled]="!hasChangesInActiveSection() || isSavingActiveSection()"
                      (click)="onSaveCurrentSection()">
                      <span *ngIf="isSavingActiveSection()" class="spinner">‚è≥</span>
                      <span *ngIf="!isSavingActiveSection()">{{ getSaveButtonText() }}</span>
                    </button>
                  </div>
                </div>

                <!-- Location Section -->
                <div *ngIf="activeSection === 'location'" class="section-content">
                  <div class="section-header">
                    <h2>Where's your place located?</h2>
                    <p>Guests will see this on the map.</p>
                  </div>
                  
                  <div formGroupName="location" class="location-form">
                    <div class="form-group">
                      <label for="address" class="form-label">Address</label>
                      <input
                        type="text"
                        id="address"
                        formControlName="address"
                        class="form-control"
                        [class.is-invalid]="propertyForm.get('location.address')?.invalid && propertyForm.get('location.address')?.touched"
                        placeholder="Enter street address">
                      <div class="invalid-feedback" *ngIf="propertyForm.get('location.address')?.invalid && propertyForm.get('location.address')?.touched">
                        Address is required
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="city" class="form-label">City</label>
                      <input
                        type="text"
                        id="city"
                        formControlName="city"
                        class="form-control"
                        [class.is-invalid]="propertyForm.get('location.city')?.invalid && propertyForm.get('location.city')?.touched"
                        placeholder="Enter city">
                      <div class="invalid-feedback" *ngIf="propertyForm.get('location.city')?.invalid && propertyForm.get('location.city')?.touched">
                        City is required
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="country" class="form-label">Country</label>
                      <input
                        type="text"
                        id="country"
                        formControlName="country"
                        class="form-control"
                        [class.is-invalid]="propertyForm.get('location.country')?.invalid && propertyForm.get('location.country')?.touched"
                        placeholder="Enter country">
                      <div class="invalid-feedback" *ngIf="propertyForm.get('location.country')?.invalid && propertyForm.get('location.country')?.touched">
                        Country is required
                      </div>
                    </div>
                  </div>

                  <!-- Save Section for Location -->
                  <div class="content-save-section">
                    <button
                      type="button"
                      class="save-btn-content"
                      [class]="getSaveButtonClass()"
                      [disabled]="!hasChangesInActiveSection() || isSavingActiveSection() || propertyForm.get('location')?.invalid"
                      (click)="onSaveCurrentSection()">
                      <span *ngIf="isSavingActiveSection()" class="spinner">‚è≥</span>
                      <span *ngIf="!isSavingActiveSection()">{{ getSaveButtonText() }}</span>
                    </button>
                  </div>
                </div>

              </form>
            </div>
            
            <!-- Loading state when property is not loaded -->
            <div *ngIf="!property && !isLoading" class="empty-state">
              <p>No property data available</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
